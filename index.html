
<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø© Ù…ØªÙƒØ§Ù…Ù„ - ÙˆØ§Ø¬Ù‡Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</title>
<style>
Â  :root{--primary:#2563eb;--muted:#6b7280;--bg:#f3f4f6}
Â  body{font-family:Tahoma, Arial, sans-serif;background:var(--bg);margin:0;padding:0}
Â  header{background:var(--primary);color:#fff;padding:12px 18px;text-align:center}
Â  .container{padding:16px}
Â  .tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px;justify-content:center}
Â  .tabs button{background:#fff;border:1px solid #ddd;padding:8px 12px;border-radius:6px;cursor:pointer}
Â  .tabs button.active{background:var(--primary);color:#fff;border-color:var(--primary)}
Â  .panel{display:none;background:#fff;padding:12px;border-radius:8px;border:1px solid #e5e7eb}
Â  .panel.active{display:block}
Â  table{width:100%;border-collapse:collapse;margin-top:8px}
Â  th,td{border:1px solid #e6e7eb;padding:6px;text-align:center}
Â  th{background:#111827;color:#fff}
Â  input,select,textarea{width:100%;box-sizing:border-box;padding:6px}
Â  .row{display:flex;gap:8px}
Â  .col{flex:1}
Â  .actions{margin-top:10px;display:flex;gap:8px}
Â  button.primary{background:var(--primary);color:#fff;border:none;padding:8px 12px;border-radius:6px}
Â  button.ghost{background:#fff;border:1px solid #ddd;padding:8px;border-radius:6px}
Â  #popup{display:none;position:fixed;left:10%;top:8%;width:80%;height:70%;background:#fff;border:2px solid var(--primary);z-index:999;padding:12px;overflow:auto}
Â  #popup table th{background:var(--primary)}
Â  footer{padding:10px;text-align:center;color:var(--muted)}
Â  .small-btn{padding:4px 6px;font-size:13px}
</style>
</head>
<body>
<header>
Â  <h1>Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø©ğŸ¥³ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³/"Ø¹Ø±ÙØ§Øª Ø§Ø­Ù…Ø¯"ğŸŒ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - ÙˆØ§Ø¬Ù‡Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© (HTML + JS)</h1>
</header>
<div class="container">
Â  <div class="tabs" id="tabs">
Â Â Â  <button class="active" data-panel="itemsPanel">Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
Â Â Â  <button data-panel="suppliersPanel">Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ†</button>
Â Â Â  <button data-panel="customersPanel">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
Â Â Â  <button data-panel="purchasesPanel">ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª</button>
Â Â Â  <button data-panel="salesPanel">ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</button>
Â Â Â  <button data-panel="journalPanel">Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</button>
Â  </div>Â  <!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->Â  <section id="itemsPanel" class="panel active">
Â Â Â  <h3>ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
Â Â Â  <div class="actions">
Â Â Â Â Â  <button class="primary" onclick="addItemRow()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
Â Â Â Â Â  <button class="ghost" onclick="saveTable('items')">ğŸ’¾ Ø­ÙØ¸</button>
Â Â Â Â Â  <button class="ghost" onclick="loadTable('items')">ğŸ”„ ØªØ­Ù…ÙŠÙ„</button>
Â Â Â  </div>
Â Â Â  <table id="itemsTable">
Â Â Â Â Â  <thead><tr><th>Ø±Ù‚Ù…_Ø§Ù„ØµÙ†Ù</th><th>ÙƒÙˆØ¯</th><th>Ø§Ø³Ù…_Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø³Ø¹Ø±_Ø§Ù„Ø´Ø±Ø§Ø¡</th><th>Ø³Ø¹Ø±_Ø§Ù„Ø¨ÙŠØ¹</th><th>Ø§Ù„Ø­Ø¯_Ø§Ù„Ø£Ø¯Ù†Ù‰</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
Â Â Â Â Â  <tbody></tbody>
Â Â Â  </table>
Â  </section>Â  <!-- Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ† -->Â  <section id="suppliersPanel" class="panel">
Â Â Â  <h3>ğŸ­ Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ†</h3>
Â Â Â  <div class="actions">
Â Â Â Â Â  <button class="primary" onclick="addSupplierRow()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯</button>
Â Â Â Â Â  <button class="ghost" onclick="saveTable('suppliers')">ğŸ’¾ Ø­ÙØ¸</button>
Â Â Â Â Â  <button class="ghost" onclick="loadTable('suppliers')">ğŸ”„ ØªØ­Ù…ÙŠÙ„</button>
Â Â Â  </div>
Â Â Â  <table id="suppliersTable">
Â Â Â Â Â  <thead><tr><th>Ø±Ù‚Ù…_Ø§Ù„Ù…ÙˆØ±Ø¯</th><th>Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th></tr></thead>
Â Â Â Â Â  <tbody></tbody>
Â Â Â  </table>
Â  </section>Â  <!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->Â  <section id="customersPanel" class="panel">
Â Â Â  <h3>ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
Â Â Â  <div class="actions">
Â Â Â Â Â  <button class="primary" onclick="addCustomerRow()">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
Â Â Â Â Â  <button class="ghost" onclick="saveTable('customers')">ğŸ’¾ Ø­ÙØ¸</button>
Â Â Â Â Â  <button class="ghost" onclick="loadTable('customers')">ğŸ”„ ØªØ­Ù…ÙŠÙ„</button>
Â Â Â  </div>
Â Â Â  <table id="customersTable">
Â Â Â Â Â  <thead><tr><th>Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th></tr></thead>
Â Â Â Â Â  <tbody></tbody>
Â Â Â  </table>
Â  </section>Â  <!-- Ù…Ø´ØªØ±ÙŠØ§Øª -->Â  <section id="purchasesPanel" class="panel">
Â Â Â  <h3>ğŸ“„ ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
Â Â Â  <div class="row">
Â Â Â Â Â  <div class="col">
Â Â Â Â Â Â Â  <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
Â Â Â Â Â Â Â  <select id="purchasePayment" onchange="togglePurchaseSupplier()"><option value="cash">Ù†Ù‚Ø¯Ù‹Ø§</option><option value="bank">Ø¨Ù†Ùƒ</option><option value="credit">Ø¢Ø¬Ù„</option></select>
Â Â Â Â Â  </div>
Â Â Â Â Â  <div class="col" id="purchaseSupplierDiv" style="display:none">
Â Â Â Â Â Â Â  <label>Ø§Ù„Ù…ÙˆØ±Ø¯ (Ø§Ø³Ù…/Ø±Ù‚Ù…):</label>
Â Â Â Â Â Â Â  <input id="purchaseSupplier" placeholder="Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
Â Â Â Â Â  </div>
Â Â Â Â Â  <div class="col">
Â Â Â Â Â Â Â  <label>Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù†Ù‚Ù„:</label>
Â Â Â Â Â Â Â  <input id="purchaseTransport" type="number" value="0">
Â Â Â Â Â  </div>
Â Â Â Â Â  <div class="col">
Â Â Â Â Â Â Â  <label>Ø®ØµÙ… Ù…ÙƒØªØ³Ø¨:</label>
Â Â Â Â Â Â Â  <input id="purchaseDiscount" type="number" value="0">
Â Â Â Â Â  </div>
Â Â Â  </div><table id="purchaseItemsTable">
Â  <thead><tr><th>Ø±Ù‚Ù…_Ø§Ù„ØµÙ†Ù</th><th>Ø§Ø³Ù…_Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø±_Ø§Ù„Ø´Ø±Ø§Ø¡</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ø®ØªÙŠØ§Ø±</th></tr></thead>
Â  <tbody></tbody>
</table>
<div class="actions">
Â  <button class="primary" onclick="addPurchaseRow()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
Â  <button class="ghost" onclick="savePurchase()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
Â  <button class="ghost" onclick="loadPurchases()">ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ù…Ø­ÙÙˆØ¸</button>
</div>
<h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="purchaseGrand">0</span></h4>

Â  </section>Â  <!-- Ù…Ø¨ÙŠØ¹Ø§Øª -->Â  <section id="salesPanel" class="panel">
Â Â Â  <h3>ğŸ“„ ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
Â Â Â  <div class="row">
Â Â Â Â Â  <div class="col">
Â Â Â Â Â Â Â  <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
Â Â Â Â Â Â Â  <select id="salesPayment" onchange="toggleSalesCustomer()"><option value="cash">Ù†Ù‚Ø¯Ù‹Ø§</option><option value="bank">Ø¨Ù†Ùƒ</option><option value="credit">Ø¢Ø¬Ù„</option></select>
Â Â Â Â Â  </div>
Â Â Â Â Â  <div class="col" id="salesCustomerDiv" style="display:none">
Â Â Â Â Â Â Â  <label>Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø³Ù…/Ø±Ù‚Ù…):</label>
Â Â Â Â Â Â Â  <input id="salesCustomer" placeholder="Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
Â Â Â Â Â  </div>
Â Â Â Â Â  <div class="col">
Â Â Â Â Â Â Â  <label>Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØªØ­Ù…ÙŠÙ„:</label>
Â Â Â Â Â Â Â  <input id="salesShipping" type="number" value="0">
Â Â Â Â Â  </div>
Â Â Â Â Â  <div class="col">
Â Â Â Â Â Â Â  <label>Ø®ØµÙ… Ù…Ø³Ù…ÙˆØ­:</label>
Â Â Â Â Â Â Â  <input id="salesDiscount" type="number" value="0">
Â Â Â Â Â  </div>
Â Â Â  </div>
Â Â Â  <table id="salesItemsTable">
Â Â Â Â Â  <thead><tr><th>Ø±Ù‚Ù…_Ø§Ù„ØµÙ†Ù</th><th>Ø§Ø³Ù…_Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø±_Ø§Ù„Ø¨ÙŠØ¹</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ø®ØªÙŠØ§Ø±</th></tr></thead>
Â Â Â Â Â  <tbody></tbody>
Â Â Â  </table>
Â Â Â  <div class="actions">
Â Â Â Â Â  <button class="primary" onclick="addSalesRow()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
Â Â Â Â Â  <button class="ghost" onclick="saveSale()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
Â Â Â Â Â  <button class="ghost" onclick="loadSales()">ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ù…Ø­ÙÙˆØ¸</button>
Â Â Â  </div>
Â Â Â  <h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="salesGrand">0</span></h4>
Â  </section>Â  <!-- Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->Â  <section id="journalPanel" class="panel">
Â Â Â  <h3>ğŸ“˜ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø¹Ø±Ø¶ ØªØ¬Ø±ÙŠØ¨ÙŠ)</h3>
Â Â Â  <div class="actions">
Â Â Â Â Â  <button class="primary" onclick="recomputeJournal()">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ù…Ù† Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
Â Â Â Â Â  <button class="ghost" onclick="saveTable('journal')">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙˆØ¯</button>
Â Â Â Â Â  <button class="ghost" onclick="loadTable('journal')">ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙŠÙˆØ¯</button>
Â Â Â  </div>
Â Â Â  <table id="journalTable"><thead><tr><th>Ø±Ù‚Ù…_Ø§Ù„Ù‚ÙŠØ¯</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ù…Ø¯ÙŠÙ†</th><th>Ø¯Ø§Ø¦Ù†</th></tr></thead><tbody></tbody></table>
Â  </section></div><!-- Popup Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù/Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†/Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ --><div id="popup">
Â  <h3 id="popupTitle">Ù‚Ø§Ø¦Ù…Ø©</h3>
Â  <div style="margin-bottom:8px"><input id="popupSearch" placeholder="Ø§Ø¨Ø­Ø«..." oninput="renderPopupList()"></div>
Â  <table id="popupTable"><thead><tr><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù…Ø¹Ù„ÙˆÙ…Ø©</th><th>Ø§Ø®ØªÙŠØ§Ø±</th></tr></thead><tbody></tbody></table>
Â  <div style="margin-top:8px;text-align:left"><button class="ghost" onclick="closePopup()">Ø¥ØºÙ„Ø§Ù‚</button></div>
</div><footer>Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ (localStorage). Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·ÙˆÙŠØ± Ù„Ø±Ø¨Ø· API Ø­Ù‚ÙŠÙ‚ÙŠ.</footer><script>
/* ---------------- Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙˆØªÙ‡ÙŠØ¦Ø© ---------------- */
const STORAGE_PREFIX = 'acc_demo_v1_';
let items = JSON.parse(localStorage.getItem(STORAGE_PREFIX+'items')) || [
Â  {item_id: generateId('I'), item_code:'101', item_name:'Ø³ÙƒØ± Ø£Ø¨ÙŠØ¶', category:'Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©', unit:'ÙƒØ¬Ù…', purchase_price:250, sale_price:300, min_qty:5, status:'Ù†Ø´Ø·'}
];
let suppliers = JSON.parse(localStorage.getItem(STORAGE_PREFIX+'suppliers')) || [];
let customers = JSON.parse(localStorage.getItem(STORAGE_PREFIX+'customers')) || [];
let purchases = JSON.parse(localStorage.getItem(STORAGE_PREFIX+'purchases')) || [];
let sales = JSON.parse(localStorage.getItem(STORAGE_PREFIX+'sales')) || [];
let journal = JSON.parse(localStorage.getItem(STORAGE_PREFIX+'journal')) || [];

// ØªØ¨ÙˆÙŠØ¨Ø§Øª
document.querySelectorAll('.tabs button').forEach(btn=> btn.addEventListener('click', ()=>{
Â  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
Â  btn.classList.add('active');
Â  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
Â  document.getElementById(btn.dataset.panel).classList.add('active');
Â  renderAll();
}));

// Ø±Ù†Ø¯Ø± Ø£ÙˆÙ„ÙŠ
renderAll();

/* ---------------- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ---------------- */
function generateId(prefix='X'){return prefix+Date.now().toString(36).slice(-6);} 
function saveToStorage(key,data){localStorage.setItem(STORAGE_PREFIX+key, JSON.stringify(data));}
function loadFromStorage(key){try{return JSON.parse(localStorage.getItem(STORAGE_PREFIX+key))||[];}catch(e){return []}}

/* ---------------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù ---------------- */
function renderItems(){
Â  const tbody = document.querySelector('#itemsTable tbody'); tbody.innerHTML='';
Â  items.forEach(it=>{
Â Â Â  const tr = document.createElement('tr');
Â Â Â  tr.innerHTML = `<td>${it.item_id}</td><td><input value="${it.item_code||''}" onchange="updateItem('${it.item_id}','item_code',this.value)"></td>
Â Â Â Â Â  <td><input value="${it.item_name||''}" onchange="updateItem('${it.item_id}','item_name',this.value)"></td>
Â Â Â Â Â  <td><input value="${it.category||''}" onchange="updateItem('${it.item_id}','category',this.value)"></td>
Â Â Â Â Â  <td><input value="${it.unit||''}" onchange="updateItem('${it.item_id}','unit',this.value)"></td>
Â Â Â Â Â  <td><input type='number' value='${it.purchase_price||0}' onchange="updateItem('${it.item_id}','purchase_price',this.value)"></td>
Â Â Â Â Â  <td><input type='number' value='${it.sale_price||0}' onchange="updateItem('${it.item_id}','sale_price',this.value)"></td>
Â Â Â Â Â  <td><input type='number' value='${it.min_qty||0}' onchange="updateItem('${it.item_id}','min_qty',this.value)"></td>
Â Â Â Â Â  <td><select onchange="updateItem('${it.item_id}','status',this.value)"><option ${it.status==='Ù†Ø´Ø·'?'selected':''}>Ù†Ø´Ø·</option><option ${it.status==='ØºÙŠØ± Ù†Ø´Ø·'?'selected':''}>ØºÙŠØ± Ù†Ø´Ø·</option></select></td>`;
Â Â Â  tbody.appendChild(tr);
Â  });
}
function addItemRow(){ const newItem={item_id:generateId('I'), item_code:'', item_name:'', category:'', unit:'', purchase_price:0, sale_price:0, min_qty:0, status:'Ù†Ø´Ø·'}; items.push(newItem); renderItems(); }
function updateItem(id,field,value){ const it = items.find(x=>x.item_id===id); if(!it) return; if(['purchase_price','sale_price','min_qty'].includes(field)) it[field]=Number(value); else it[field]=value; saveToStorage('items',items); }
function saveTable(key){ if(key==='items') saveToStorage('items',items); if(key==='suppliers') saveToStorage('suppliers',suppliers); if(key==='customers') saveToStorage('customers',customers); if(key==='journal') saveToStorage('journal',journal); alert('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§: '+key); }
function loadTable(key){ if(key==='items') items = loadFromStorage('items'); if(key==='suppliers') suppliers = loadFromStorage('suppliers'); if(key==='customers') customers = loadFromStorage('customers'); if(key==='journal') journal = loadFromStorage('journal'); renderAll(); alert('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„: '+key); }

/* ---------------- Ù…ÙˆØ±Ø¯ÙˆÙ† Ùˆ Ø¹Ù…Ù„Ø§Ø¡ ---------------- */
function renderSuppliers(){ const tbody=document.querySelector('#suppliersTable tbody'); tbody.innerHTML=''; suppliers.forEach(s=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${s.supplier_id}</td><td><input value='${s.name||''}' onchange="updateSupplier('${s.supplier_id}','name',this.value)"></td><td><input value='${s.phone||''}' onchange="updateSupplier('${s.supplier_id}','phone',this.value)"></td><td><input value='${s.address||''}' onchange="updateSupplier('${s.supplier_id}','address',this.value)"></td><td><input type='number' value='${s.balance||0}' onchange="updateSupplier('${s.supplier_id}','balance',this.value)"></td>`; tbody.appendChild(tr); }); }
function addSupplierRow(){ const s={supplier_id:generateId('S'), name:'', phone:'', address:'', balance:0}; suppliers.push(s); renderSuppliers(); }
function updateSupplier(id,field,val){ const s=suppliers.find(x=>x.supplier_id===id); if(!s) return; s[field]= (field==='balance')?Number(val):val; saveToStorage('suppliers',suppliers); }
function renderCustomers(){ const tbody=document.querySelector('#customersTable tbody'); tbody.innerHTML=''; customers.forEach(c=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${c.customer_id}</td><td><input value='${c.name||''}' onchange="updateCustomer('${c.customer_id}','name',this.value)"></td><td><input value='${c.phone||''}' onchange="updateCustomer('${c.customer_id}','phone',this.value)"></td><td><input value='${c.address||''}' onchange="updateCustomer('${c.customer_id}','address',this.value)"></td><td><input type='number' value='${c.balance||0}' onchange="updateCustomer('${c.customer_id}','balance',this.value)"></td>`; tbody.appendChild(tr); }); }
function addCustomerRow(){ const c={customer_id:generateId('C'), name:'', phone:'', address:'', balance:0}; customers.push(c); renderCustomers(); }
function updateCustomer(id,field,val){ const c=customers.find(x=>x.customer_id===id); if(!c) return; c[field]= (field==='balance')?Number(val):val; saveToStorage('customers',customers); }

/* ---------------- Ù…Ø´ØªØ±ÙŠØ§Øª: Ø¥Ø¯Ø®Ø§Ù„ ÙˆØªÙˆÙ„ÙŠØ¯ Ù‚ÙŠØ¯ ---------------- */
function addPurchaseRow(){ const tbody=document.querySelector('#purchaseItemsTable tbody'); const tr=document.createElement('tr'); tr.innerHTML = `<td><input oninput="purchaseFill(this)"></td><td><input oninput="purchaseFill(this)"></td><td><input type='number' oninput="purchaseCalc(this)" onkeydown="purchaseNext(event)"></td><td><input type='number' oninput="purchaseCalc(this)"></td><td><input readonly></td><td><button class='small-btn' onclick="openPopupFor(this,'items')">Ø§Ø®ØªÙŠØ§Ø±</button></td>`; tbody.appendChild(tr);} 
function purchaseFill(el){ const tr=el.closest('tr'); const id=tr.cells[0].querySelector('input').value.trim(); const name=tr.cells[1].querySelector('input').value.trim().toLowerCase(); let found = items.find(x=> x.item_id===id || x.item_code===id || x.item_name.toLowerCase().includes(name)); if(found){ tr.cells[0].querySelector('input').value = found.item_id; tr.cells[1].querySelector('input').value = found.item_name; tr.cells[3].querySelector('input').value = found.purchase_price||0; purchaseCalc(el);} }
function purchaseCalc(el){ const tr=el.closest('tr'); const qty=Number(tr.cells[2].querySelector('input').value)||0; const price=Number(tr.cells[3].querySelector('input').value)||0; tr.cells[4].querySelector('input').value = (qty*price).toFixed(2); recalcPurchaseGrand(); }
function recalcPurchaseGrand(){ let total=0; document.querySelectorAll('#purchaseItemsTable tbody tr').forEach(r=> total += Number(r.cells[4].querySelector('input').value)||0); const transport=Number(document.getElementById('purchaseTransport').value)||0; const discount=Number(document.getElementById('purchaseDiscount').value)||0; const net = total + transport - discount; document.getElementById('purchaseGrand').innerText = net.toFixed(2); }
function purchaseNext(e){ if(e.key==='Enter'){ e.preventDefault(); addPurchaseRow(); }}
function togglePurchaseSupplier(){ document.getElementById('purchaseSupplierDiv').style.display = (document.getElementById('purchasePayment').value==='credit')? 'block' : 'none'; }

function savePurchase(){ // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
Â  const supplierVal = document.getElementById('purchaseSupplier').value.trim(); if(document.getElementById('purchasePayment').value==='credit' && supplierVal===''){return alert('Ù…Ø·Ù„ÙˆØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¢Ø¬Ù„');}
Â  const itemsList = [];
Â  document.querySelectorAll('#purchaseItemsTable tbody tr').forEach(r=>{
Â Â Â  const id = r.cells[0].querySelector('input').value; const name = r.cells[1].querySelector('input').value; const qty = Number(r.cells[2].querySelector('input').value)||0; const price = Number(r.cells[3].querySelector('input').value)||0; const total = Number(r.cells[4].querySelector('input').value)||0; if(id && qty>0) itemsList.push({item_id:id, item_name_snapshot:name, purchase_price_snapshot:price, quantity:qty, total});
Â  });
Â  if(itemsList.length===0) return alert('Ø£Ø¯Ø®Ù„ ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
Â  const purchase = {purchase_id: generateId('P'), supplier: supplierVal, payment_method: document.getElementById('purchasePayment').value, transport: Number(document.getElementById('purchaseTransport').value)||0, discount: Number(document.getElementById('purchaseDiscount').value)||0, items: itemsList, created_at: new Date().toISOString() };
Â  purchases.push(purchase); saveToStorage('purchases',purchases);
Â  // ØªØ­Ø¯ÙŠØ« Items quantities Ùˆ total_purchases
Â  itemsList.forEach(li=>{ const it = items.find(x=> x.item_id===li.item_id); if(it){ it.total_purchases = (Number(it.total_purchases)||0) + Number(li.quantity); it.remaining_qty = (Number(it.total_purchases)||0) - (Number(it.total_sales)||0); }});
Â  saveToStorage('items',items);
Â  // ØªÙˆÙ„ÙŠØ¯ Ù‚ÙŠØ¯ Ù…Ø¨Ø³Ø· ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø¯ÙØªØ±
Â  const je = {journal_id: generateId('J'), date: new Date().toISOString(), reference: purchase.purchase_id, description:'ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª '+purchase.purchase_id, debit: itemsList.reduce((s,i)=>s+Number(i.total),0)+purchase.transport - purchase.discount, credit: itemsList.reduce((s,i)=>s+Number(i.total),0)+purchase.transport - purchase.discount};
Â  journal.push(je); saveToStorage('journal',journal);
Â  alert('âœ… ØªÙ… Ø­ÙØ¸ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§. Ù…Ø¹Ø±Ù: '+purchase.purchase_id);
Â  renderAll(); }
function loadPurchases(){ purchases = loadFromStorage('purchases'); renderAll(); alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª'); }

/* ---------------- Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© ---------------- */
function addSalesRow(){ const tbody=document.querySelector('#salesItemsTable tbody'); const tr=document.createElement('tr'); tr.innerHTML = `<td><input oninput="salesFill(this)"></td><td><input oninput="salesFill(this)"></td><td><input type='number' oninput="salesCalc(this)" onkeydown="salesNext(event)"></td><td><input type='number' oninput="salesCalc(this)"></td><td><input readonly></td><td><button class='small-btn' onclick="openPopupFor(this,'items')">Ø§Ø®ØªÙŠØ§Ø±</button></td>`; tbody.appendChild(tr);} 
function salesFill(el){ const tr=el.closest('tr'); const id=tr.cells[0].querySelector('input').value.trim(); const name=tr.cells[1].querySelector('input').value.trim().toLowerCase(); let found = items.find(x=> x.item_id===id || x.item_code===id || x.item_name.toLowerCase().includes(name)); if(found){ tr.cells[0].querySelector('input').value = found.item_id; tr.cells[1].querySelector('input').value = found.item_name; tr.cells[3].querySelector('input').value = found.sale_price||0; salesCalc(el);} }
function salesCalc(el){ const tr=el.closest('tr'); const qty=Number(tr.cells[2].querySelector('input').value)||0; const price=Number(tr.cells[3].querySelector('input').value)||0; tr.cells[4].querySelector('input').value = (qty*price).toFixed(2); recalcSalesGrand(); }
function recalcSalesGrand(){ let total=0; document.querySelectorAll('#salesItemsTable tbody tr').forEach(r=> total += Number(r.cells[4].querySelector('input').value)||0); const ship=Number(document.getElementById('salesShipping').value)||0; const disc=Number(document.getElementById('salesDiscount').value)||0; const net = total + ship - disc; document.getElementById('salesGrand').innerText = net.toFixed(2); }
function salesNext(e){ if(e.key==='Enter'){ e.preventDefault(); addSalesRow(); }}
function toggleSalesCustomer(){ document.getElementById('salesCustomerDiv').style.display = (document.getElementById('salesPayment').value==='credit')? 'block' : 'none'; }
function saveSale(){ const customerVal = document.getElementById('salesCustomer').value.trim(); if(document.getElementById('salesPayment').value==='credit' && customerVal==='') return alert('Ù…Ø·Ù„ÙˆØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¢Ø¬Ù„'); const itemsList=[]; document.querySelectorAll('#salesItemsTable tbody tr').forEach(r=>{ const id=r.cells[0].querySelector('input').value; const name=r.cells[1].querySelector('input').value; const qty=Number(r.cells[2].querySelector('input').value)||0; const price=Number(r.cells[3].querySelector('input').value)||0; const total=Number(r.cells[4].querySelector('input').value)||0; if(id && qty>0) itemsList.push({item_id:id,item_name_snapshot:name,sale_price_snapshot:price,quantity:qty,total}); }); if(itemsList.length===0) return alert('Ø£Ø¯Ø®Ù„ ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'); const sale={sale_id:generateId('S'), customer: customerVal, payment_method: document.getElementById('salesPayment').value, shipping: Number(document.getElementById('salesShipping').value)||0, discount: Number(document.getElementById('salesDiscount').value)||0, items: itemsList, created_at: new Date().toISOString()}; sales.push(sale); saveToStorage('sales',sales); // ØªØ­Ø¯ÙŠØ« items.total_sales
itemsList.forEach(li=>{ const it = items.find(x=> x.item_id===li.item_id); if(it){ it.total_sales = (Number(it.total_sales)||0) + Number(li.quantity); it.remaining_qty = (Number(it.total_purchases)||0) - (Number(it.total_sales)||0); }}); saveToStorage('items',items); // ØªÙˆÙ„ÙŠØ¯ Ù‚ÙŠØ¯ Ù…Ø¨Ø³Ø·
const je={journal_id:generateId('J'), date:new Date().toISOString(), reference:sale.sale_id, description:'ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª '+sale.sale_id, debit: itemsList.reduce((s,i)=>s+Number(i.total),0)+sale.shipping - sale.discount, credit: itemsList.reduce((s,i)=>s+Number(i.total),0)+sale.shipping - sale.discount}; journal.push(je); saveToStorage('journal',journal); alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§. Ù…Ø¹Ø±Ù: '+sale.sale_id); renderAll(); }
function loadSales(){ sales = loadFromStorage('sales'); renderAll(); alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'); }

/* ---------------- Ù†Ø§ÙØ°Ø© Popup ---------------- */
let popupContext = null; // 'items'|'suppliers'|'customers'
let popupTargetRow = null;
function openPopupFor(btn,ctx){ popupContext = ctx; popupTargetRow = btn.closest('tr'); document.getElementById('popupTitle').innerText = (ctx==='items')? 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù' : (ctx==='suppliers')? 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†' : 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'; document.getElementById('popupSearch').value=''; renderPopupList(); document.getElementById('popup').style.display='block';}
function closePopup(){ document.getElementById('popup').style.display='none'; popupContext=null; popupTargetRow=null; }
function renderPopupList(){ const q=document.getElementById('popupSearch').value.trim().toLowerCase(); const tbody=document.querySelector('#popupTable tbody'); tbody.innerHTML=''; let list=[]; if(popupContext==='items') list = items; if(popupContext==='suppliers') list = suppliers; if(popupContext==='customers') list = customers; list.filter(x=> !q || (x.item_name? x.item_name.toLowerCase().includes(q) : x.name && x.name.toLowerCase().includes(q))).forEach(it=>{ const tr=document.createElement('tr'); const label = popupContext==='items' ? (it.item_code||'') : ''; const name = popupContext==='items' ? it.item_name : (it.name||''); const info = popupContext==='items'? (it.purchase_price||'') : (it.phone||''); tr.innerHTML = `<td>${popupContext==='items'? it.item_id : (it.supplier_id || it.customer_id)}</td><td>${name}</td><td>${info}</td><td><button class='small-btn' onclick="popupSelect('${popupContext}','${popupContext==='items'?it.item_id:(it.supplier_id||it.customer_id)}')">Ø§Ø®ØªÙŠØ§Ø±</button></td>`; tbody.appendChild(tr); }); }
function popupSelect(ctx,id){ if(ctx==='items' && popupTargetRow){ const it = items.find(x=>x.item_id===id); popupTargetRow.cells[0].querySelector('input').value = it.item_id; popupTargetRow.cells[1].querySelector('input').value = it.item_name; popupTargetRow.cells[3].querySelector('input').value = it.purchase_price||0; purchaseCalc(popupTargetRow.cells[3].querySelector('input')); }
if(ctx==='suppliers'){ const s = suppliers.find(x=>x.supplier_id===id); document.getElementById('purchaseSupplier').value = s.name; }
if(ctx==='customers'){ const c = customers.find(x=>x.customer_id===id); document.getElementById('salesCustomer').value = c.name; }
closePopup(); }

/* ---------------- Ù‚ÙŠÙˆØ¯: Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ù…Ø¨Ø³Ø· ---------------- */
function recomputeJournal(){ journal = []; purchases = loadFromStorage('purchases'); sales = loadFromStorage('sales'); purchases.forEach(p=>{ journal.push({journal_id:generateId('J'),date:p.created_at,reference:p.purchase_id,description:'Ù‚ÙŠØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª '+p.purchase_id,debit: p.items.reduce((s,i)=>s+Number(i.total),0)+Number(p.transport||0)-Number(p.discount||0), credit: p.items.reduce((s,i)=>s+Number(i.total),0)+Number(p.transport||0)-Number(p.discount||0)}); }); sales.forEach(s=>{ journal.push({journal_id:generateId('J'),date:s.created_at,reference:s.sale_id,description:'Ù‚ÙŠØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª '+s.sale_id,debit: s.items.reduce((t,i)=>t+Number(i.total),0)+Number(s.shipping||0)-Number(s.discount||0), credit: s.items.reduce((t,i)=>t+Number(i.total),0)+Number(s.shipping||0)-Number(s.discount||0)}); }); saveToStorage('journal',journal); renderJournal(); alert('âœ… Ø£ÙØ¹ÙŠØ¯ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ù…Ù† Ø§Ù„ÙÙˆØ§ØªÙŠØ±'); }

function renderJournal(){ const tbody=document.querySelector('#journalTable tbody'); tbody.innerHTML=''; journal.forEach(j=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td>${j.journal_id}</td><td>${new Date(j.date).toLocaleString()}</td><td>${j.description}</td><td>${(j.debit||0).toFixed(2)}</td><td>${(j.credit||0).toFixed(2)}</td>`; tbody.appendChild(tr); }); }

/* ---------------- Ø±Ù†Ø¯Ø± Ø´Ø§Ù…Ù„ ---------------- */
function renderAll(){ renderItems(); renderSuppliers(); renderCustomers(); renderJournal(); // ensure at least one row in invoices
if(document.querySelector('#purchaseItemsTable tbody').children.length===0) addPurchaseRow(); if(document.querySelector('#salesItemsTable tbody').children.length===0) addSalesRow(); recalcPurchaseGrand(); recalcSalesGrand(); }

</script></body>
</html>

